<!doctype html>
<html>
  <head>
    <title>Force Cache Clear</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
  </head>
  <body>
    <h1>Clearing Cache...</h1>
    <p>This page will clear all cached files and redirect you to the app.</p>

    <script>
      console.log('Force clearing all caches...')

      // Clear all caches
      if ('caches' in window) {
        caches.keys().then(function (names) {
          console.log('Found caches:', names)
          for (let name of names) {
            caches.delete(name)
            console.log('Deleted cache:', name)
          }
        })
      }

      // Clear all storage
      if (typeof Storage !== 'undefined') {
        localStorage.clear()
        sessionStorage.clear()
        console.log('Cleared localStorage and sessionStorage')
      }

      // Clear service worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function (registrations) {
          for (let registration of registrations) {
            registration.unregister()
            console.log('Unregistered service worker')
          }
        })
      }

      // Add cache busting parameter and redirect
      setTimeout(() => {
        const timestamp = new Date().getTime()
        window.location.href = `/?v=${timestamp}`
      }, 1000)
    </script>
  </body>
</html>
